<html lang="en">
<head>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css" media="screen">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

  <!-- Custom CSS -->
  <link rel="stylesheet" type="text/css" href="/css/syntax2.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/extras.css" media="screen">
</head>

  <meta name="keywords" content="MESA, Summer School, Binary, Massive Star, simulation"/>
  <title>Massive Binaries</title>
</head>

<body id='binaries-body' data-spy="scroll" data-target="#super-side-nav" data-offset="1">
  <div class="splash-binaries">
    <h1 class='d-none d-md-block display-2'>Interacting Massive Binaries</h1>
    <h1 class='d-none d-sm-block d-md-none display-3'>Interacting Massive Binaries</h1>
    <h1 class='d-xs-block d-sm-none display-4'>Interacting Massive Binaries</h1>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-md-3 sticky-top align-self-start d-none d-md-block" id="super-side-nav">
        <nav class="nav nav-pills flex-column" id='side-nav'>
  <a class="nav-link" href="#overview">Overview</a>
  <a class="nav-link part-header" href="#part1">Minilab 1: Envelope Stripping in a Binary</a>
  <nav class="nav nav-pills flex-column" id='part1-subparts'>
    <a class="nav-link ml-3 my-1" href="#part1a">Objectives</a>
    <a class="nav-link ml-3 my-1" href="#part1b">Intro to Binary Module</a>
    <a class="nav-link ml-3 my-1" href="#part1c">Envelope Stripping</a>
    <a class="nav-link ml-3 my-1" href="#part1d">Updating M&#775;</a>
    <a class="nav-link ml-3 my-1" href="#part1e">Ionizing Radiation <em>(Bonus)</em></a>
  </nav>
  <a class="nav-link part-header" href="#part2">Minilab 2: X-ray Binaries and Supernova Progenitors</a>
  <nav class="nav nav-pills flex-column" id="part2-subparts">
    <a class="nav-link ml-3 my-1" href="#part2a">Objectives</a>
    <a class="nav-link ml-3 my-1" href="#part2b">Stripped-envelope Supernovae</a>
    <a class="nav-link ml-3 my-1" href="#part2c">Supernova Progenitors</a>
    <a class="nav-link ml-3 my-1" href="#part2d">High-mass X-ray Binaries</a>
  </nav>
  <a class="nav-link part-header" href="#part3">Maxilab: Massive Binary Mergers</a>
</nav>

      </div>
      <div class="col-12 col-md-9"  id="binaries-instructions">
        <h2 id='overview'> Overview </h2>
<p>
  This guide accompanies the final set of exercises for the 
  <a href="http://cococubed.asu.edu/mesa_summer_school_2021/" target=_blank>
    2021 MESA Summer School
  </a>
  led by lecturer 
  <a href="https://users.obs.carnegiescience.edu/ygoetberg/" target=_blank>
    Ylva Goetberg
  </a>
  and TAs
  <a href="https://billwolf.space" target=_blank>
    Bill Wolf
  </a>
  and Eb Farag.
</p>
<h4>About These Exercises</h4>
<p>
  These lab exercises will have you exploring the topic of massive star binaries using the <samp>binary</samp> module of <samp>MESA</samp>. This page will likely fall out of date as the interface of <samp>MESA</samp> changes in its development and the hyperlinks on this page become outdated.
  For greatest compatibility, you should use the following versions of <samp>MESA</samp> and the SDK:
</p>
<dl class="row">
  <dt class="col-4 col-sm-3 col-xl-2">MESA Version</dt>
  <dd class="col-8 col-sm-9 col-xl-10">
    <a href="https://github.com/MESAHub/mesa/releases/tag/r15140" target=_blank>15104</a>
  </dd>

  <dt class="col-4 col-sm-3 col-xl-2">SDK Version</dt>
  <dd class="col-8 col-sm-9 col-xl-10">21.4.1 (Mac <em>or</em> Linux)</dd>
</dl>
<p>
  Throughout this page, monospaced text on a black background, like this: <kbd>echo "Hello, World!"</kbd> represent commands you can type into your terminal and execute, while red monospaced text like this: <code>mass_change = 1d-9</code> represent file names or values that you might type into a file, but not something to be executed.
</p>

<h4>Science Background</h4>
<p>
  Massive stars are important for many fields of astrophysics: they are thought to have provided most of the ionizing radiation that caused cosmic reionization, their remnants merge in gravitational wave events, and they even produced the oxygen we breathe. Understanding the evolution of massive stars is therefore a key component, for example, when interpreting the radiation from distant galaxies or estimating the merger rates of neutron stars.
</p>
<p>
  However, massive stars are not born alone. In fact, they spend their lives in so close of an orbit with at least one companion star that dramatic interaction is bound to happen as the stars evolve and swell. Through interaction, many solar masses of material can be exchanged between the two stars, X-rays can be produced, and the stars can even coalesce. In this lab, we will use MESA’s binary module to model a variety of interactions in massive binaries.
</p>

<h4>The Labs in Summary</h4>
<p>
  We have prepared three laboratory exercises that will familiarize you with how to use the <code>binary</code> module to model interacting binary stars, as well as some of the difficulties you might run into in the process.
</p>
<dl class='row'>
  <dt class='col-sm-3 col-lg-2'>Minilab 1</dt>
  <dd class='col-sm-9 col-lg-10'>Get familiarized with the <code>MESA binary</code> module by modeling the evolution of a star that loses its fluffy, hydrogen-rich envelope via mass transfer to a companion star. Also experiment with changing the wind mass loss prescription.</dd>
  <dt class='col-sm-3 col-lg-2'>Minilab 2</dt>
  <dd class='col-sm-9 col-lg-10'>Explore what types of supernovae to expect from envelope-stripped stars and model the prior X-ray binary phase.</dd>
  <dt class='col-sm-3 col-lg-2'>Maxilab</dt>
  <dd class='col-sm-9 col-lg-10'>Make exploratory models of binary stars that merge and further evolve the resulting merger products.</dd>
</dl>
<hr>
<h2 id="part1" class='mt-5'> Minilab 1: Envelope Stripping in a Binary </h2>
<h4 id="part1a" class='mt-4'> Objectives</h4>
<p>In this lab you will learn&#8230;</p>
<ul>
  <li>The structure of a <code>binary</code> work directory</li>
  <li>How to roche lobe overflow from a stellar model to a point mass</li>
  <li>Several scenarios that can cause roche lobe overflow in massive star binaries</li>
</ul>
<hr>
<h4 id="part1b" class='mt-4'>Introduction to <code>MESA binary</code></h4>
<p class='lead'>
  <span class='font-weight-bold text-primary'>Task 0: Download Materials</span>
  For both of the minilabs, we will use the same basic work directory and models that we will slightly modify. Depending on when you complete this exercise, you might find these files on the summer school dropbox, or later, at the Zenodo repository. For convenience, they are available for download from this tutorial:
</p>
<div class="text-center">
  <a href="Gotberg_minilab1_2.tar.gz" download>
    <button class='btn btn-primary btn-lg'>
      Download Minilab Files
    </button>
  </a>
</div>
<p class='lead'>
  <span class='font-weight-bold'> Starting from the tarball</span>
  <ul class='lead'>
    <li>
      Move the tarball/directory from your downlaods to where you'd like it to live.<br>
      <kbd>mv ~/Downloads/Gotberg_minilab1_2.tar.gz <var>PATH/WHERE/YOU/WANT/IT/</var></kbd>
    </li>
    <li>
      Navigate to the enclosing folder<br>
      <kbd>cd <var>PATH/WHERE/YOU/WANT/IT</var></kbd>
    </li>
    <li>
      Untar the files<br>
      <kbd>tar -xvzf Gotberg_minilab1_2.tar.gz</kbd>
    </li>
    <li>
      Finally, navigate to the <code>minilab1</code> folder within the new directory.<br>
      <kbd>cd Gotberg_minilab1_2/minilab1</kbd>.  
    </li>
  </ul>    
</p>
<p class='lead'>
  <span class='font-weight-bold'> Starting from a full folder download (Dropbox/Zenodo</span>
  <ul class='lead'>
    <li>
      Find the appropriate folder on Dropbox (during the summer school) or Zenodo (afterward) and download it.
    </li>
    <li>
      Move the folder from downloads to where you'd like it to live long term.<br>
      <kbd>mv ~/Downloads/Gotberg_minilab1_2 <var>PATH/WHERE/YOU/WANT/IT/</var>
    </li>
    <li>
      Navigate to the <code>minilab1</code> directory within the downloaded folder:<br>
      <kbd>cd <var>PATH/WHERE/YOU/WANT/IT</var>/Gotberg_minilab1_2/minilab1</kbd>
    </li>
  </ul>
</p>
<p class='lead'>
  Finally, list the files in the directory (<kbd>ls</kbd>) and notice the similarities and differences from a typical <code>MESA star</code> work directory.
</p>

<p>
  <code>MESA</code> has a <code>binary</code> module, which is very similar to the <code>star</code> module, but has the capability to evolve two stars simultaneously while also accounting for mass exchange between them. To accommodate both stars and the binary orbit, there is one inlist for the binary orbit (<code>inlist_project</code>) which points to one inlist for each of the stars (<code>inlist1</code>, <code>inlist2</code>). It is also possible to evolve just one of the stars in the system, while treating the other as a point mass, which can be handy when simulating systems composed of a star and a compact object. Similar to the <code>star</code> module, there is a <code>binary_history.data</code> output file which tracks information about the binary system while there still are the history.data and profile files for the individual components in their respective <code>LOGS1/2</code> folders. There is also a <code>run_binary_extras.f90</code> file in the <code>src</code> directory, for when you need to access the two stars at the same time or interact with parameters of the binary orbit. 
</p>
<!-- <p>
  The first minilab directory is not very different from the standard <code>binary</code> work directory located at <code>$MESA_DIR/binary/work</code>, much like its cousin from <code>star</code>. It has a very similar structure with a few key differences stemming from the fact that <code>binary</code> can model two stars simultaneously, which we'll call star 1 and star 2. While it models the two stars in sync, it also tracks data about the binary itself, such as orbital separation, orbital period, and mass transfer rates.
</p>-->
 <p>
  Click through on some of the file names below. Most that look familiar from <code>star</code> have similar or identical functions in <code>binary</code>, but in some cases, like the multiple inlists and LOGS directories, are more nuanced.
</p>
<div class="row" id="workdir-files">
  <div class="col-md-3">
    <div class="list-group info-toggle" data-target="#file-description">
      <a href="#part1b" class="list-group-item list-group-item-action active" data-name="inlist" data-description="Similar to the same file in star work directories, but this inlist controls the three <code>binary</code> namelists (<code>binary_job</code>, <code>binary_controls</code>, and <code>binary_pgstar</code>). Often this punts to other inlist files to separate different functionalities, like <code>inlist_project</code>.">
        inlist
      </a>
      <a href="#part1b" class="list-group-item list-group-item-action" data-name="inlist_project" data-description="Another <code>binary</code> inlist that <code>inlist</code> points to. The name isn't special; it just matches what extra inlist is loaded by <code>inlist</code>. Note that this inlist still pertains to the <code>binary</code> module, and <em>not</em> the <code>star</code> module, like you may be accustomed to.">inlist_project</a>
      <a href="#part1b" class="list-group-item list-group-item-action"data-name="inlist_pgstar" data-description="Inlists that set the normal physical parameters for <code>MESA star</code> models that will correspond with the two stars in the binaries. These can punt to other inlists (like <code>inlist_donor</code> and <code>inlist_pgstar_binary</code> in our example). The names of these files are controlled by the <code>inlist_names</code> array in the <code>binary_job</code> namelist.">inlist1 and inlist2</a>
      <a href="#part1b" class="list-group-item list-group-item-action" data-name="mk" data-description="Same as in <code>star</code>: Executable script that recompiles the local copy of <code>star</code>. You only need to execute this if you make changes to files in the <code>src</code> directory or upgrade <samp>MESA</samp>.">mk</a>
      <a href="#part1b" class="list-group-item list-group-item-action" data-name="rn" data-description="Same as in <code>star</code>: Executable that, after compilation with <code>mk</code> starts the simulation defined by <code>inlist</code> and any custom code in <code>src/run_star_extras.f</code>.">rn</a>
      <a href="#part1b" class="list-group-item list-group-item-action" data-name="re" data-description="Executable that restarts an interrupted or completed run from a pair of earlier photos. It takes one argument, which is a photo file found in all three of <code>photos</code>, <code>photos1</code> and <code<photos2</code>, which contain data for the binary as a whole, star 1, and star 2, respectively.">re</a>
      
    </div>
  </div>
  <div class="col-md-3">
    <div class="list-group info-toggle" data-target="#file-description">
      <a href="#part1b" class="list-group-item list-group-item-action" data-name="clean" data-description="Same as in <code>star</code>: Executable that resets the compilation process done by <code>mk</code>. Typically only needed if you are running a simulation that was previously compiled by a different version of the SDK or from an older version of <samp>MESA</samp>">
        clean
      </a>
      <a href="#part1b" class="list-group-item list-group-item-action" data-name="star" data-description="The actual executable that evolves the binary stellar model. Usually this is wrapped by <code>rn</code> and <code>re</code>. You should almost never call it directly.">binary</a>
      <a href="#part1b" class="list-group-item list-group-item-action"data-name="LOGS" data-description="Standard <code>MESA star</code> logs directories for star 1 and star 2, respectively. Additional history data for the binary itself is stored in <code>binary_history.data</code>">LOGS1 and LOGS2</a>
      <a href="#part1b" class="list-group-item list-group-item-action" data-name="photos" data-description="Directories that holds snapshots of the simulation stored in binary. These are used to restart the simulation, but they are <strong>not</strong> for long-term storage of the model, as their format changes from version to version.">photos, photos1, photos2</a>
      <a href="#part1b" class="list-group-item list-group-item-action" data-name="src" data-description="Directory that contains source code for the executable built by <code>mk</code>. Most is just read in from the main <code>MESA_DIR</code>, but you can add your own code to <code>run_star_extras.f</code> and <code>run_binary_extras.f</code>.">src</a>
      <a href="#part1b" class="list-group-item list-group-item-action" data-name="make" data-description="Directory that contains the makefile and byproducts of the compilation process. You rarely need to fiddle with this.">make</a>
      
    </div>
  </div>
  <div class="col-md-6">
    <div class="card" id='file-description'>
      <div class="card-header bg-primary text-white">
        <samp class='name'>inlist</samp>
      </div>
      <div class="card-body">
        <p class='card-text description'>
          Similar to the same file in star work directories, but this inlist controls the three <code>binary</code> namelists (<code>binary_job</code>, <code>binary_controls</code>, and <code>binary_pgstar</code>). Often this punts to other inlist files to separate different functionalities, like <code>inlist_project</code>.
        </p>
      </div>
    </div>
  </div>
</div>

<h4 id='part1c' class='mt-4'>Envelope Stripping with a Black Hole Companion</h4>
<p>
  About a third of all massive stars are expected to lose their hydrogen-rich envelopes either via mass transfer or the successful ejection of a common envelope. Here, we start exploring envelope-stripping via Roche-lobe overflow (RLOF, mass transfer) in a binary initially composed of a 14 M<sub>&#8857;</sub> star that orbits an 8<sub>&#8857;</sub> black hole every 20 days. To speed up the models, we will model stars at the sub-solar metallicity <var>Z</var> = 0.006 (similar to the metallicity in the Large Magellanic Cloud). 
</p>

<p class='lead'>
  <span class='font-weight-bold text-primary'>Task 1: Prepare your Model</span> While in the <code>minilab1</code> work directory&#8230;
  <ul class='lead'>
    <li>
      Update the <strong>initial masses</strong> and <strong>initial period</strong> of the two stars in <code>inlist_project</code>. Star 1 will be the 14 M<sub>&#8857;</sub> star, and star 2 will be the 8 M<sub>&#8857;</sub> black hole.
    </li>
    <li>
      Locate the 14 M<sub>&#8857;</sub> zero-age main sequence model in the <code>ZAMS_models</code> folder and make sure your simulation will use it to start from.
    </li>
    <li>
      Update <code>inlist1</code> to reflect that this starting model uses a different metallicity than the default in <code>MESA</code>.
    </li>
    <li>
      Compile and run the code.
    </li>
  </ul>
</p>

<div class="card border-warning mb-3">
  <div class="card-header text-white bg-warning">
    <h5 class='card-title mb-0'>
      <samp>MESA</samp> Warning: Low Resolution Runs
    </h5>
  </div>
  <div class="card-body">
    <p>
      The process of determining the correct mass transfer rate in a binary run is an iterative process. Essentially, the solver guesses a mass transfer rate and then checks to see if the donor star has receded within its roche lobe. It then tries to find the "right" mass transfer rate to get the final radius within some tolerance of the roche lobe.
    </p>
    <p>
      To make these runs go more quickly, we have lowered this tolerance, as well as the general spatial and temporal tolerances of the donor star model. A more science-ready exploration should investigate if these tolerances are sufficient for robust results (they likely aren't).
    </p>
  </div>
</div>

<div class="card border-info mb-3">
  <div class="card-header text-white bg-info">
    <h5 class='card-title mb-0'>
      <samp>MESA</samp> Pro Tip: Pesky Permissions
    </h5>
  </div>
  <div class="card-body">
    <p class='card-text'>
      Did you download a whole folder or a zipped folder, and then try to use an executable like <kbd>./mk</kbd> or <kbd>./mk</kbd>, only to be greeted by a a message like <code>permission denied: ./mk</code>?
    </p>

    <p class='card-text'>
      Usually this means there is a file permissions error, which can arise from these ways of transmitting files. If you execute <kbd>ls -l</kbd> in the directory, and the lines for those executable files (like <code>rn</code>) don't start with <code>-rwx</code>, and instead have <code>-rw-</code> (i.e., the "x" is missing from the first four characters), you do not have permission to execute the file, which is exactly what you want to do.
    </p>

    <p class='card-text'>
      The solution is simple, fortunately! Just give yourself execution priveleges on those files:
    </p>

    <p class='card-text'>
      <kbd>chmod +x mk</kbd><br>
      <kbd>chmod +x rn</kbd><br>
      <kbd>chmod +x re</kbd>
    </p>

    <p class='card-text'>
      Check that the permission was updated with <kbd>ls -l</kbd> again. If the "x" is present, you should be able to use these executables properly.
    </p>
    <p class='card-text'><em>Note:</em> some will recommend using <kbd>chmod 777</kbd> instead of <kbd>chmod +x</kbd>, which will also work, but is overy generous with applying priveleges to all users rather than just yourself. It's not a great habit to pick up since you might apply this panacea where differential permissions really are important.
    </p>
  </div>
</div>


<div class="card border-success mb-3">
  <div class="card-header bg-success text-white make-clickable">
    <button class="btn btn-link text-reset stretched-link" type="button" data-toggle="collapse" data-target="#sol1_1" aria-expanded="true" aria-controls="sol1_1">
      Show Solution 1
    </button>
  </div>
  <div class="card-body collapse" id="sol1_1">
    <p class="card-text">
      Set the masses of the two stars and their initial orbital period in <code>inlist_project</code>:
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="p">&amp;</span><span class="n">binary_controls</span><span class="w">

 </span><span class="c1">! Initial conditions for the binary</span><span class="w">
   </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">14.0d0</span><span class="w"> </span><span class="c1">! donor mass in Msun</span><span class="w">
   </span><span class="n">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8.0d0</span><span class="w"> </span><span class="c1">! companion mass in Msun</span><span class="w">
   </span><span class="n">initial_period_in_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20.0d0</span><span class="w"> </span></code></pre></figure>
    </p> 
    <p class='card-text'>
      Select the starting model in the <code>star_job</code> namelist in <code>inlist_donor</code>. Note that you must first copy <code>zams_14Msun.mod</code> to the <code>minilab1</code> directory from the <code>ZAMS_models</code> directory (or you could give a path like <code>../ZAMS_models/zams_14Msun.mod</code>)
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">  </span><span class="c1">! Load ZAMS model</span><span class="w">
    </span><span class="n">load_saved_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">.true.</span><span class="w">
    </span><span class="n">saved_model_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'zams_14Msun.mod'</span></code></pre></figure>
    </p>
    <p class='card-text'>
      Finally, we must account for the reduced metallicity in the stellar model in <code>inlist1</code>:
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="p">&amp;</span><span class="n">kap</span><span class="w">
  </span><span class="c1">! kap options</span><span class="w">
  </span><span class="c1">! see kap/defaults/kap.defaults</span><span class="w">
  </span><span class="n">use_Type2_opacities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">.true.</span><span class="w">
  </span><span class="n">Zbase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.006</span></code></pre></figure>
      We technically don't need to set <code>initial_z</code> since we are loading a saved model that already has that information. However, this data is written to any saved model that is created from the inlist, so it's a good practice to also set <code>initial_z</code> to 0.006.
    </p>
    <p class='card-text'>
      To compile, execute <kbd>./mk</kbd> and to run, execute <kbd>./rn</kbd> as usual.
    </p>
  </div>
</div>

<p>
  A large pgstar dashboard should pop up. Study each panel and see if you can understand what they are showing you. Can you recognize the mass transfer phase in the Hertzsprung-Russell diagram? Can you distinguish the mass transfer from wind mass loss? 
</p>

<p class='lead'>
  <span class='font-weight-bold text-primary'>Task 2: Analyze the Model</span> At the time the simulation stops, the stellar model should be fusing helium to carbon to carbon and oxygen in its center. Identify the following characteristics for this binary stellar model. All quantities refer to the donor star unless otherwise indicated.
</p>
<ul class='lead'>
  <li>Mass</li>
  <li>Effective Temperature</li>
  <li>Radius</li>
  <li>Peak mass transfer rate over simulation</li>
  <li>Final mass loss rate from donor star</li>
  <li>Companion (black hole) mass</li>
  <li>Orbital period in days</li>
</ul>
<div class="card border-primary mb-3">
  <div class="card-header bg-primary text-white">
    <button class="btn btn-link text-reset" type="button" data-toggle="collapse" data-target="#hint1_2a" aria-expanded="true" aria-controls="hint1_2a">
      Show Hint: Where Do I Look?
    </button>
  </div>
  <div class="card-body collapse" id="hint1_2a">
    <p class="card-text">
      There are several places you can get this information:
      <ul>
        <li>The final pgstar frame. If you closed it already, you can find all frames saved in <code>grid_png</code> (or make a movie out of these! <a href='#movie-tip'>See the tip below</a>).</li>
        <li>Terminal output. Do note that there are two types of outputs now. One is the standard one for <code>star</code> (for the donor star) and the other is for quantities relevant to the binary, which always start with <code>bin</code> in the upper left.</li>
        <li>The binary history (<code>binary_history.data</code>) and donor history (<code>LOGS1/history.data</code>) files.</li>
      </ul>
    </p>
  </div>
</div>
<div class="card border-success mb-3">
  <div class="card-header bg-success text-white make-clickable">
    <button class="btn btn-link text-reset stretched-link" type="button" data-toggle="collapse" data-target="#sol1_2" aria-expanded="true" aria-controls="sol1_2">
      Show Solution 2
    </button>
  </div>
  <div class="card-body collapse" id="sol1_2">
    <p class='card-text'>
      You can find the following by closely studying the last pgstar frame, <code>LOGS1/history.data</code> and/or <code>binary_history.data</code>. Note that pgstar frames have been saved to the <code>grid_png</code> folder so you can look at them after the run.
    </p>
    <ul class="card-text">
      <li>Mass: &#8776; 5.3 M<sub>&#8857;</sub></li>
      <li>Effective Temperature: &#8776; 91,000 K</li>
      <li>Radius: &#8776; 0.91 R<sub>&#8857;</sub></li>
      <li>Peak mass transfer rate over simulation: ~ 10<sup>–2</sup> M<sub>&#8857;</sub></li>
      <li>Final mass loss rate from donor star ~ 10<sup>–6</sup> M<sub>&#8857;</sub>/yr</li>
      <li>Companion (black hole) mass: &#8776; 15 M<sub>&#8857;</sub></li>
      <li>Orbital period in days: &#8776; 38 days</li>
    </ul>
    <p>
      As you can see, this is not a regular 5 M<sub>&#8857;</sub> star! It is extremely hot and very small, since it is essentially the exposed helium core of a massive star.
    </p>
  </div>
</div>

<div class="card border-info mb-3" id='movie-tip'>
  <div class="card-header text-white bg-info">
    <h5 class='card-title mb-0'>
      <samp>MESA</samp> Pro Tip: Making pgstar Movies
    </h5>
  </div>
  <div class="card-body">
    <p>
      The <code>inlist_pgstar_binary</code> inlist is instructing your model to dutifuly output pngs of pgstar frames to the folder <code>grid_png</code>. While you shouldn't need past frames to answer the questions in this task, you still might find it useful to create a movie out of these. Fortunately, that ability is baked in to the <code>MESA</code> SDK! Simply use the script <code>images_to_movies</code>.
    </p>

    <p>
      <code>images_to_movies</code> takes a glob string and a name for an output video file. The glob string should be something like <code>'grid_png/grid_*.png'</code> (the quotes are evidently important!), which can match the files you wish to use as frames. Then the output file should end in <code>mp4</code> to indicate making an mp4 movie, so something like <code>to_he_exhaustion.mp4</code>. So putting it all together:
    </p>
    <p>
      <kbd>images_to_movie 'grid_png/grid_*.png' to_he_exhaustion.mp4</kbd>
    </p>
  </div>
</div>
<h4 id='part1d' class='mt-4'>Updating the Wind Mass-Loss Scheme</h4>
<p>
  The default wind mass-loss rate for stripped stars in <code>MESA</code> is an extrapolation of the <a href="https://ui.adsabs.harvard.edu/abs/2000A%26A...360..227N/abstract" target=_blank>Nugis & Lamers (2000)</a> empirical wind mass-loss recipe created from a sample of Galactic Wolf-Rayet (WR) stars. This extrapolation reproduces relatively accurately the wind mass loss rate from the only published intermediate mass stripped star, the &#8776;4 M<sub>&#8857;</sub> quasi-WR star in the binary HD 45166 (<a href="https://ui.adsabs.harvard.edu/abs/2008A%26A...485..245G/abstract" target=_blank>Groh et al., 2008</a>). However, a recent theoretical model from <a href="https://ui.adsabs.harvard.edu/abs/2017A%26A...607L...8V/abstract" target=_blank>Vink (2017)</a> predicts that the wind mass loss rate from intermediate mass stripped stars should be significantly lower. This, because WR stars are so bright that radiation pressure contributes to the wind mass-loss, while it should be unimportant for intermediate mass stripped stars, which are less luminous. As a result, Vink (2017) proposed that the wind mass-loss rate from stripped stars is related to the luminosity and metallicity following the relation:
</p>
<p>
  \[\log\dot{M} = -13.3 + 1.36\log\left(L/L_\odot\right) + 0.61\log\left(Z/Z_\odot\right)\]
</p>
<p>
  If stellar winds are strong, they can significantly alter the stellar properties of a star, revealing deeper, chemically enriched layers. For stripped stars, the amount of hydrogen left over after mass transfer not only affects the stellar properties, but also the possibility to interact again and the supernova type (see <a href="#part2">minilab 2</a>). 
</p>
<p class='lead'>
  <span class='font-weight-bold text-primary'>Task 3: Implement a Custom Wind</span> Make a copy of your first work directory that you used for the first two tasks. In the new directory, implement the Vink (2017) wind mass loss rate for stripped stars with mass <10 M<sub>&#8857;</sub> in the run_star_extras.f90 file and activate the <code>other_wind</code> hook. Note that we have prepared a function into which you can implement the new wind mass loss scheme. 
</p>

<div class="card border-primary mb-3">
  <div class="card-header bg-primary text-white">
    <button class="btn btn-link text-reset" type="button" data-toggle="collapse" data-target="#hint1_3a" aria-expanded="true" aria-controls="hint1_3a">
      Show Hint: Duplicating the Work Directory
    </button>
  </div>
  <div class="card-body collapse" id="hint1_3a">
    <p class='card-text'>
      So that we maintain the old work directory, which we'll need later, we need to duplicate our starter directory. First, navigate back up a level:
    </p>
    <p class='card-text'>
      <kbd>cd ..</kbd>
    </p>
    <p class='card-text'>
      And now we need to copy the whole directory to a new one and then enter it. You can pick any name for this directory, but pick something that helps you understand what's special about it. Here we'll call it <code>minilab1_vink17</code>:
    </p>
    <p class='card-text'>
      <kbd>cp -r minilab1 minilab1_vink17</kbd><br>
      <kbd>cd minilab1_vink17</kbd>
    </p>
    <p class='card-text'>
      While not essential, you might also consider clearing out old logs, photos, and pgstar data to prevent old data from interfering with new data:
    </p>
    <p class='card-text'>
      <kbd>rm -f photos/*</kbd><br>
      <kbd>rm -rf LOGS1</kbd><br>
      <kbd>rm -f grid_png/*</kbd>
    </p>
  </div>
</div>

<div class="card border-primary mb-3">
  <div class="card-header bg-primary text-white">
    <button class="btn btn-link text-reset" type="button" data-toggle="collapse" data-target="#hint1_3b" aria-expanded="true" aria-controls="hint1_3b">
      Show Hint: Implementing the <code class='text-white'>other_wind</code> Hook
    </button>
  </div>
  <div class="card-body collapse" id="hint1_3b">
    <p class="card-text">
      Usually, to implement the <code>other_wind</code> hook, you need to write your own subroutine to actually compute the wind (pursuant to a particular signature found in <code>$MESA_DIR/star/other/other_wind.f90</code>). However, we've already done <em>most</em> of that for you here. Look inside <code>src/run_star_extras.f90</code> and see if you can find the routine that [mostly] computes the wind for our stellar model.
    </p>
    <p class='card-text'>
      Once you've found the routine, edit it so that the Vink (2017) routine fires when the model has
      <ul>
        <li>a mass less than 10 M<sub>&#8857;</sub> <strong>AND</strong></li>
        <li>a surface hydrogen fraction less than 0.40</li>
      </ul>
      You might notice that in the existing routine, there's already an if/else block that chooses between different wind routines based on similar considerations and then calls an internal subroutine (look below the <code>contains</code> keyword) to actually evaluate the wind mass loss rate. You might emulate this organization and create your own internal subroutine whose sole job is to set its lone input <code>w</code> to the mass loss rate described in the equation above, and then calling it in the if/else block under the correct circumstances.
    </p>

    <p class='card-text'>
      You should start to see the modified wind in use sometime around star 1's model number 1028 (equivalently, binary model number 159). Consider adding a <code>write</code> statement to confirm that it is being called at this time.
  </div>
</div>

<div class="card border-primary mb-3">
  <div class="card-header bg-primary text-white">
    <button class="btn btn-link text-reset" type="button" data-toggle="collapse" data-target="#hint1_3c" aria-expanded="true" aria-controls="hint1_3c">
      Show Hint: Activating the <code class='text-white'>other_wind</code> Hook
    </button>
  </div>
  <div class="card-body collapse" id="hint1_3c">
    <p class="card-text">
      Once you have updated the implementation of the wind routine, you need to do two things to have it actually get called:
      <ol>
        <li>Point <code>s% other_wind</code> to the routine that should set the wind (in <code>extras_controls</code> within <code>run_star_extras.f90</code>).</li>
        <li>Ensure that a line (not shown here) is added to the <code>controls</code> namelist of star 1 that tells it to use the other wind hook.</li>
      </ol>
    </p>
  </div>
</div>

<div class="card border-success mb-3">
  <div class="card-header bg-success text-white make-clickable">
    <button class="btn btn-link text-reset stretched-link" type="button" data-toggle="collapse" data-target="#sol1_3" aria-expanded="true" aria-controls="sol1_3">
      Show Solution 3
    </button>
  </div>
  <div class="card-body collapse" id="sol1_3">
    <p class='card-text'>
      The name of the subroutine we provided to do this is <code>weak_wind_stripped_stars</code>. To have this be called by the <code>other_wind</code> hook, we need to point to it in the <code>extras_controls</code> subroutine in <code>run_star_extras.f90</code>:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">      </span><span class="k">subroutine</span><span class="w"> </span><span class="n">extras_controls</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="p">)</span><span class="w">
         </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="k">in</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">id</span><span class="w">
         </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="k">out</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ierr</span><span class="w">
         </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">star_info</span><span class="p">),</span><span class="w"> </span><span class="k">pointer</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">s</span><span class="w">

         </span><span class="n">ierr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
         </span><span class="k">call</span><span class="w"> </span><span class="n">star_ptr</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="p">)</span><span class="w">
         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="p">/</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w">
         
         </span><span class="n">s</span><span class="o">%</span><span class="w"> </span><span class="n">extras_startup</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">extras_startup</span><span class="w">
         </span><span class="n">s</span><span class="o">%</span><span class="w"> </span><span class="n">extras_start_step</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">extras_start_step</span><span class="w">
         </span><span class="n">s</span><span class="o">%</span><span class="w"> </span><span class="n">extras_check_model</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">extras_check_model</span><span class="w">
         </span><span class="n">s</span><span class="o">%</span><span class="w"> </span><span class="n">extras_finish_step</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">extras_finish_step</span><span class="w">
         </span><span class="n">s</span><span class="o">%</span><span class="w"> </span><span class="n">extras_after_evolve</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">extras_after_evolve</span><span class="w">
         </span><span class="n">s</span><span class="o">%</span><span class="w"> </span><span class="n">how_many_extra_history_columns</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">how_many_extra_history_columns</span><span class="w">
         </span><span class="n">s</span><span class="o">%</span><span class="w"> </span><span class="n">data_for_extra_history_columns</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">data_for_extra_history_columns</span><span class="w">
         </span><span class="n">s</span><span class="o">%</span><span class="w"> </span><span class="n">how_many_extra_profile_columns</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">how_many_extra_profile_columns</span><span class="w">
         </span><span class="n">s</span><span class="o">%</span><span class="w"> </span><span class="n">data_for_extra_profile_columns</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">data_for_extra_profile_columns</span><span class="w"> 

         </span><span class="c1">! THIS IS THE IMPORTANT BIT (earlier lines should already exist)</span><span class="w">
         </span><span class="n">s</span><span class="o">%</span><span class="w"> </span><span class="n">other_wind</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">weak_wind_stripped_stars</span><span class="w">
      </span><span class="k">end</span><span class="w"> </span><span class="k">subroutine</span><span class="w"> </span><span class="n">extras_controls</span></code></pre></figure>
    <p class='card-text'>
      But now we need to update <code>weak_wind_stripped_stars</code> to reflect the changes we want to make. Here's the part that decides which wind routine to use: 
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">         </span><span class="c1">! Call the wind functions</span><span class="w">
         </span><span class="c1">! Hot and hydrogen rich stars (main-sequence stars)</span><span class="w">
         </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">Tsurf</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">1.0d4</span><span class="p">)</span><span class="w"> </span><span class="ow">.and.</span><span class="w"> </span><span class="p">(</span><span class="n">Xsurf</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.4</span><span class="p">))</span><span class="w"> </span><span class="k">then</span><span class="w">
            </span><span class="k">call</span><span class="w"> </span><span class="n">eval_Vink_wind</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">
         </span><span class="c1">! Hot and hydrogen poor stars </span><span class="w">
         </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">Tsurf</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">1.0d4</span><span class="p">)</span><span class="w"> </span><span class="ow">.and.</span><span class="w"> </span><span class="p">(</span><span class="n">Xsurf</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.4</span><span class="p">))</span><span class="w"> </span><span class="k">then</span><span class="w">
            </span><span class="k">call</span><span class="w"> </span><span class="n">eval_Nugis_Lamers_wind</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">
         </span><span class="c1">! Cool stars</span><span class="w">
         </span><span class="k">else</span><span class="w">
            </span><span class="k">call</span><span class="w"> </span><span class="n">eval_de_Jager_wind</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">
         </span><span class="k">end</span><span class="w"> </span><span class="k">if</span></code></pre></figure>
    <p class='card-text'>
      We want to add an extra check to the <code>else if</code> block to see if the mass is less than some limiting value. If it is, we want to call a new subroutine that implements the above wind law:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">         </span><span class="c1">! Call the wind functions</span><span class="w">
         </span><span class="c1">! Hot and hydrogen rich stars (main-sequence stars)</span><span class="w">
         </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">Tsurf</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">1.0d4</span><span class="p">)</span><span class="w"> </span><span class="ow">.and.</span><span class="w"> </span><span class="p">(</span><span class="n">Xsurf</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.4</span><span class="p">))</span><span class="w"> </span><span class="k">then</span><span class="w">
            </span><span class="k">call</span><span class="w"> </span><span class="n">eval_Vink_wind</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">
         </span><span class="c1">! Hot and hydrogen poor stars </span><span class="w">
         </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">Tsurf</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">1.0d4</span><span class="p">)</span><span class="w"> </span><span class="ow">.and.</span><span class="w"> </span><span class="p">(</span><span class="n">Xsurf</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.4</span><span class="p">))</span><span class="w"> </span><span class="k">then</span><span class="w">
            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Msurf</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">Mlim</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w">
               </span><span class="k">call</span><span class="w"> </span><span class="n">eval_Vink17_wind</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">
            </span><span class="k">else</span><span class="w">
               </span><span class="k">call</span><span class="w"> </span><span class="n">eval_Nugis_Lamers_wind</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">
            </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
         </span><span class="c1">! Cool stars</span><span class="w">
         </span><span class="k">else</span><span class="w">
            </span><span class="k">call</span><span class="w"> </span><span class="n">eval_de_Jager_wind</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">
         </span><span class="k">end</span><span class="w"> </span><span class="k">if</span></code></pre></figure>
    <p class='card-text'>
      We've introduced two new entities here. First is a real variable, <code>Mlim</code> that we need to define as 10 M<sub>&#8857;</sub>. First we declare it by tacking it on to the end of an existing declaration line:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">         </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">Tlim</span><span class="p">,</span><span class="w"> </span><span class="n">Rlim</span><span class="p">,</span><span class="w"> </span><span class="n">Zsurf</span><span class="p">,</span><span class="w"> </span><span class="n">log10w</span><span class="p">,</span><span class="w"> </span><span class="n">Ysurf</span><span class="p">,</span><span class="w"> </span><span class="n">Xsurf</span><span class="p">,</span><span class="w"> </span><span class="n">Mlim</span></code></pre></figure>
    <p class='card-text'>
      &#8230; and then we set its value where similar variables are set:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">         </span><span class="c1">! Solar metallicity</span><span class="w">
         </span><span class="n">Zsun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0134</span><span class="w">
         </span><span class="c1">! Limits</span><span class="w">
         </span><span class="n">Tlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5d4</span><span class="w">
         </span><span class="n">Rlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="o">*</span><span class="n">Rsun</span><span class="w">
         </span><span class="n">Mlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10d0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Msun</span><span class="w"> </span><span class="c1">!!! the new bits; 10 solar masses</span></code></pre></figure>
    <p class='card-text'>
      The second, and more interesting addition is the <code>eval_Vink17_wind</code> subroutine, which must be defined. Following a style similar to <code>eval_de_Jager_wind</code>, we get the following:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">        </span><span class="c1">! Vink (2017) wind for low-mass stripped stars</span><span class="w">
        </span><span class="k">subroutine</span><span class="w"> </span><span class="n">eval_Vink17_wind</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w">
           </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="k">out</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">w</span><span class="w">
           </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">log10w</span><span class="w">
           </span><span class="k">include</span><span class="w"> </span><span class="s1">'formats'</span><span class="w">
           </span><span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s2">"Calling magic wind routine!"</span><span class="w">
           </span><span class="n">log10w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-13.3d0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.36d0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">log10</span><span class="p">(</span><span class="n">Lsurf</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="n">Lsun</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">&amp;</span><span class="w">
                     </span><span class="mf">0.61d0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">log10</span><span class="p">(</span><span class="n">Zsurf</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="n">Zsun</span><span class="p">)</span><span class="w">
           </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exp10</span><span class="p">(</span><span class="n">log10w</span><span class="p">)</span><span class="w">
        </span><span class="k">end</span><span class="w"> </span><span class="k">subroutine</span><span class="w"> </span><span class="n">eval_Vink17_wind</span></code></pre></figure>
    <p class='card-text'>
      We can place this anywhere between the <code>contains</code> and <code>end subroutine weak_wind_stripped_stars</code> statements.
    </p>
    <p class='card-text'>
      But there is one last part! We need to turn the wind on in the inlist, as well. So somewhere in the <code>controls</code> namelist of <code>inlist_donor</code>, we need to add the following:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">    </span><span class="n">use_other_wind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">.true.</span></code></pre></figure>
    <p class='card-text font-weight-bold'>
      <strong>AND/OR</strong>
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">    </span><span class="n">hot_wind_scheme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'other'</span></code></pre></figure>
    <p class='card-text'>
      For your own sanity, you should probably put this in the <code>WIND MASS LOSS</code> section of the inlist. While not necessary to make this work, you should also comment out or delete the other hot and cold wind scheme controls so that you aren't confused about which wind is actually active (an <code>other_wind</code> scheme always takes precedence when it is activated).
    </p>
  </div>
</div>
<p class='lead'>
  <span class='font-weight-bold text-primary'>Task 4: Compare Models</span> Explore how the properties of the stripped star changed since you updated the wind scheme. Look at the same quantities we looked at in Task 2:
</p>
<ul class='lead'>
  <li>Mass</li>
  <li>Effective Temperature</li>
  <li>Radius</li>
  <li>Peak mass transfer rate over simulation</li>
  <li>Final mass loss rate from donor star</li>
  <li>Companion (black hole) mass</li>
  <li>Orbital period in days</li>
</ul>
<div class="card border-success mb-3">
  <div class="card-header bg-success text-white make-clickable">
    <button class="btn btn-link text-reset stretched-link" type="button" data-toggle="collapse" data-target="#sol1_4" aria-expanded="true" aria-controls="sol1_4">
      Show Solution 4
    </button>
  </div>
  <div class="card-body collapse" id="sol1_4">
    <p class='card-text'>
      You can find the following by closely studying the last pgstar frame, <code>LOGS1/history.data</code> and/or <code>binary_history.data</code>. Note that pgstar frames have been saved to the <code>grid_png</code> folder so you can look at them after the run.
    </p>
    <ul class="card-text">
      <li>Mass: &#8776; 5.6 M<sub>&#8857;</sub></li>
      <li>Effective Temperature: &#8776; 76,000 K</li>
      <li>Radius: &#8776; 1.38 R<sub>&#8857;</sub></li>
      <li>Peak mass transfer rate over simulation: ~ 10<sup>–2</sup> M<sub>&#8857;</sub></li>
      <li>Final mass loss rate from donor star ~ 10<sup>–7</sup> M<sub>&#8857;</sub>/yr</li>
      <li>Companion (black hole) mass: &#8776; 15 M<sub>&#8857;</sub></li>
      <li>Orbital period in days: &#8776; 37 days</li>
    </ul>
    <p>
      As you can see, the weaker wind for stripped stars significantly alters the effective temperature and radius of the star. This is because less hydrogen is lost via winds and since hydrogen is "fluffier" than helium, the star can be larger and therfore also a little cooler.
    </p>
  </div>
</div>
<h4 id='part1e' class='mt-4'><span class='font-weight-bold'>BONUS:</span> Ionizing Radiation</h4>
<p>
  Because stripped stars reach extremely high surface temperatures, they emit very energetic radiation. In fact, the majority of their emitted radiation is ionizing. To accurately compute the emission rate of ionizing photons, spectral models that match the properties of the stripped stars are necessary. However, the hydrogen-ionizing emission rate from intermediate mass stripped stars is quite well approximated by a blackbody radiation curve.
</p>
<p class='lead'>
  <span class='font-weight-bold text-primary'>Bonus Task 5: Track Ionizing Radiation</span> In the text file <code>Q0_function.txt</code> in the work directory, there is a function that calculates the emission rate of H-ionizing photons, <var>Q</var><sub>0</sub>. Copy this function and place it in the correct place in the <code>run_star_extras.f90</code> file so that you can add log(<var>Q</var><sub>0</sub>) as an output in the <code>history.data</code> file. Make sure to call the new column <code>log_Q0</code>. Before compiling and running the model, un-comment the fourth panel in the pgstar window (tip: search for <code>EDIT HERE</code>) so that you can see the evolution of the emission rate of H-ionizing photons. It is also advantageous to set the minimum of the y-axis to 46.
</p> 
<div class="card border-primary mb-3">
  <div class="card-header bg-primary text-white">
    <button class="btn btn-link text-reset" type="button" data-toggle="collapse" data-target="#hint1_5a" aria-expanded="true" aria-controls="hint1_5a">
      Show Hint: Adding the History Column
    </button>
  </div>
  <div class="card-body collapse" id="hint1_5a">
    <p class="card-text">
      Since you'll want the code in <code>Q0_function.txt</code> when calculating the values extra history columns, we'll want them handy inside the <code>data_for_extra_history_columns</code> subroutine. You can just paste the contents of the file at the bottom of the subroutine, but be sure to add a <code>contains</code> statement before you paste those contents.
    </p>

    <p class="card-text">
      With the code handy, you can then set the name of the new column and the value within the definition of <code>data_for_extra_columns</code> (before the <code>contains</code> statement). Setting the name is as simple as assigning <code>names(1)</code> to the proper string. Setting the value is more interesting, since the <code>calculate_Q0</code> subroutine <em>takes in a variable and sets its value to the log of Q<sub>0</sub></em>. So you <em class='font-weight-bold'>won't</em> simply do something like <code>vals(1) = calculate_Q0</code>. Instead, you'll need to call the subroutine with an input of <code>vals(1)</code>.
    </p>

    <p class='card-text'>
      Finally, even if you've defined the name and value of the new history column properly, it won't work until you update the value set in <code>how many_extra_history_columns</code>. Update this value to 1.
    </p>
  </div>
</div>

<div class="card border-primary mb-3">
  <div class="card-header bg-primary text-white">
    <button class="btn btn-link text-reset" type="button" data-toggle="collapse" data-target="#hint1_5b" aria-expanded="true" aria-controls="hint1_5b">
      Show Hint: Plotting log<sub>10</sub><var>Q</var><sub>0</sub>
    </button>
  </div>
  <div class="card-body collapse" id="hint1_5b">
    <p class="card-text">
      Look inside <code>inlist_pgstar_binary</code> and search for <code>EDIT HERE</code>. You need only make changes to the next two lines (set the name of the <var>y</var>-value to be plotted, and also update the minimum value on that axis). Leave the third line for now; we might get to it in the next minilab.
    </p>
  </div>
</div>

<div class="card border-success mb-3">
  <div class="card-header bg-success text-white make-clickable">
    <button class="btn btn-link text-reset stretched-link" type="button" data-toggle="collapse" data-target="#sol1_5" aria-expanded="true" aria-controls="sol1_5">
      Show Solution 5
    </button>
  </div>
  <div class="card-body collapse" id="sol1_5">
    <p class='card-text'>
      To create the new column in the history file, we'll need to edit the <code>how_many_extra_history_columns</code> function:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">      </span><span class="kt">integer</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">how_many_extra_history_columns</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w">
         </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="k">in</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">id</span><span class="w">
         </span><span class="kt">integer</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ierr</span><span class="w">
         </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">star_info</span><span class="p">),</span><span class="w"> </span><span class="k">pointer</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">s</span><span class="w">
         </span><span class="n">ierr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
         </span><span class="k">call</span><span class="w"> </span><span class="n">star_ptr</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="p">)</span><span class="w">
         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="p">/</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w">
         </span><span class="n">how_many_extra_history_columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
      </span><span class="k">end</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">how_many_extra_history_columns</span></code></pre></figure>
    <p class='card-text'>
      (The only change from the original code is the second-to-last line being set to 1 instead of 0.)
    </p>
    <p class='card-text'>
      To set the name and value of the new column, you need to edit the subroutine <code>data_for_extra_history_columns</code>. You only need to add the two lines that set <code>names(1)</code> and <code>vals(1)</code>:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">      </span><span class="k">subroutine</span><span class="w"> </span><span class="n">data_for_extra_history_columns</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="n">vals</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="p">)</span><span class="w">
         </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="k">in</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w">
         </span><span class="kt">character</span><span class="w"> </span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen_history_column_name</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">names</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">
         </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">vals</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w">
         </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="k">out</span><span class="p">)</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ierr</span><span class="w">
         </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="n">star_info</span><span class="p">),</span><span class="w"> </span><span class="k">pointer</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">s</span><span class="w">
         </span><span class="n">ierr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
         </span><span class="k">call</span><span class="w"> </span><span class="n">star_ptr</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="p">)</span><span class="w">
         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="p">/</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w">

         </span><span class="c1">! note: do NOT add the extras names to history_columns.list</span><span class="w">
         </span><span class="c1">! the history_columns.list is only for the built-in history column options.</span><span class="w">
         </span><span class="c1">! it must not include the new column names you are adding here.</span><span class="w">

         </span><span class="c1">! Add the emission rate of H-ionizing photons to the history file</span><span class="w">
         </span><span class="n">names</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'log_Q0'</span><span class="w">
         </span><span class="k">call</span><span class="w"> </span><span class="n">calculate_Q0</span><span class="p">(</span><span class="n">vals</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"> 

         </span><span class="k">contains</span><span class="w">

         </span><span class="c1">! below is just the contents of Q0_function.txt</span><span class="w">
         </span><span class="k">subroutine</span><span class="w"> </span><span class="n">calculate_Q0</span><span class="p">(</span><span class="n">log10_Q0</span><span class="p">)</span><span class="w">
            </span><span class="c1">! contents omitted for brevity</span><span class="w">
         </span><span class="k">end</span><span class="w"> </span><span class="k">subroutine</span><span class="w"> </span><span class="n">calculate_Q0</span><span class="w">

         </span><span class="k">pure</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">integrate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w">
            </span><span class="c1">! contents omitted for brevity</span><span class="w">
         </span><span class="k">end</span><span class="w"> </span><span class="k">function</span><span class="w">

      </span><span class="k">end</span><span class="w"> </span><span class="k">subroutine</span><span class="w"> </span><span class="n">data_for_extra_history_columns</span><span class="w">
      </span></code></pre></figure>
    <p class='card_text'>
      Finally, we need to plot this quantity in the pgstar dashboard. Edit these lines in <code>inlist_pgstar_binary</code>:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">      </span><span class="c1">! The fourth panel </span><span class="w">
      </span><span class="c1">! ! ! ! EDIT HERE ! ! ! ! ! ! !</span><span class="w">
      </span><span class="n">History_Panels1_yaxis_name</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="c1">!'log_Q0'   ! Extra exercise, minilab 1</span><span class="w">
      </span><span class="c1">!History_Panels1_ymin(4) = 46  ! Extra exercise, minilab 1</span></code></pre></figure>
    <p class='card-text'>
      to this:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">      </span><span class="c1">! The fourth panel </span><span class="w">
      </span><span class="c1">! ! ! ! EDIT HERE ! ! ! ! ! ! !</span><span class="w">
      </span><span class="n">History_Panels1_yaxis_name</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'log_Q0'</span><span class="w">   </span><span class="c1">! Extra exercise, minilab 1</span><span class="w">
      </span><span class="n">History_Panels1_ymin</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">46</span><span class="w">  </span><span class="c1">! Extra exercise, minilab 1</span></code></pre></figure>

  </div>
</div>

<p>
  OB-type stars are through to provide most of the ionizing radiation in a stallar population. Let's compare our star to published main sequence OB stars from the literature. Below is a subset of a table taken from <a href="https://ui.adsabs.harvard.edu/abs/2002MNRAS.337.1309S/abstract" target=_blank>Smith et al. 2002</a> (see the full dataset in Table 1 of that paper) that shows how the emission rates of hydrogen-ionizing (<var>Q</var><sub>0</sub>) photons vary with the spectral type of stellar models.
</p>
<div class='row'>
  <div class='col-8 offset-2'>
  <table class='table table-striped table-hover table-sm table-responsive'>
    <caption>
      Stellar parameters and ionizing photon emission rates of <var>Z</var> = 0.4 Z<sub>&#8857;</sub> ZAMS models from <a href="https://ui.adsabs.harvard.edu/abs/2002MNRAS.337.1309S/abstract" target=_blank>Smith et al. 2002</a>
    </caption>
    <thead class='thead-dark'>
      <tr>
        <th>Spectral Type</th>
        <th><var>T</var><sub>eff</sub> (kK)</th>
        <th><var>R</var><sub>*</sub> (R<sub>&#8857;</sub>)</th>
        <th>log<var>Q</var><sub>0</sub>
      </tr>
    </thead>
    <tbody>
      <tr class='text-center'>
        <td>O3V</td>
        <td>50.0</td>
        <td>9.8</td>
        <td>49.5</td>
      </tr>
      <tr class='text-center'>
        <td>O4V</td>
        <td>45.7</td>
        <td>10.4</td>
        <td>49.4</td>
      </tr>
      <tr class='text-center'>
        <td>O5V</td>
        <td>42.6</td>
        <td>10.5</td>
        <td>49.2</td>
      </tr>
      <tr class='text-center'>
        <td>O7V</td>
        <td>40.0</td>
        <td>10.6</td>
        <td>49.0</td>
      </tr>
      <tr class='text-center'>
        <td>O7.5V</td>
        <td>37.2</td>
        <td>10.5</td>
        <td>48.8</td>
      </tr>
      <tr class='text-center'>
        <td>O8V</td>
        <td>34.6</td>
        <td>10.5</td>
        <td>48.4</td>
      </tr>
      <tr class='text-center'>
        <td>O9V</td>
        <td>32.3</td>
        <td>10.1</td>
        <td>47.9</td>
      </tr>
      <tr class='text-center'>
        <td>B0V</td>
        <td>30.2</td>
        <td>9.5</td>
        <td>47.3</td>
      </tr>
      <tr class='text-center'>
        <td>B0.5V</td>
        <td>28.1</td>
        <td>8.6</td>
        <td>46.8</td>
      </tr>
      <tr class='text-center'>
        <td>B1V</td>
        <td>26.3</td>
        <td>8.1</td>
        <td>46.4</td>
      </tr>
      <tr class='text-center'>
        <td>B1.5V</td>
        <td>25.0</td>
        <td>7.1</td>
        <td>46.1</td>
      </tr>
    </tbody>
  </table>
  </div>
</div>
<p class='lead'>
  <span class='font-weight-bold text-primary'>Bonus Task 6: Compare to ZAMS Models</span> Look at Table 1 and decide <strong class='font-weight-bold'>which ZAMS stellar model has the most similar rate of H-ionizing photons as your stripped star?</strong> After making this comparison based on <var>Q</var><sub>0</sub> alone, compare how the stellar radius and effective temperature of the stripped star compares with its ZAMS counterpart. 
</p>

<div class="card border-success mb-3">
  <div class="card-header bg-success text-white make-clickable">
    <button class="btn btn-link text-reset stretched-link" type="button" data-toggle="collapse" data-target="#sol1_6" aria-expanded="true" aria-controls="sol1_6">
      Show Solution 6
    </button>
  </div>
  <div class="card-body collapse" id="sol1_6">
    <p class='card-text'>
      You should find (e.g. in the last pgstar snapshot) that log<sub>10</sub><var>Q</var><sub>0</sub> ended a little above 48.6. Looking at the table above, that means that <strong>our stripped stellar model is most similar to an O7.5V star</strong> (log<sub>10</sub><var>Q</var><sub>0</sub> = 48.8 in the table above).
    </p>
    <figure class='figure'>
      <img class='figure-img img-fluid rounded' src='images/Q0_history.png' alt='yellow line on a black graph'>
      <figcaption class="figure-caption text-left">
        History of log <var>Q</var><sub>10</sub> showing a final value just above 48.6.
      </figcaption>
    </figure>
    <p class='card-text'>
      An 07.5V type stars are massive main sequence stars with masses around 20 M<sub>&#8857;</sub>.
      Note that the effective temperature of our model is roughly 40,000 K higher than its ZAMS counterpart, but its radius is about an order of magnitude smaller. This makes sense, as our smaller star must be more luminous and/or have a harder spectrum to produce the same amount of H-ionizing photons per unit time.
    </p>
  </div>
</div>
<hr class='my-5'>
<h2 id="part2" class='mt-5'> Minilab 2: X-ray Binaries and Supernova Progenitors </h2>
<h4 id='part2a' class='mt-4'>Objectives</h4>
<p>
  In this lab you will&#8230;
  <ul>
    <li>
      Deepen your understanding of the <code>binary</code> module by altering the behavior of the accretor through modifying <code>inlist_project</code>
    </li>
    <li>
      Perform a parameter space study in mass and initial period to demonstrate the variety of supernova types that can be obtained from interacting binaries
    </li>
    <li>
      Learn how to use <code>run_binary_extras.f90</code> to record and visualize data beyond the default history data columns
    </li>
  </ul>
</p>
<h4 id='part2b' class='mt-4'>Stripped-envelope Supernovae</h4>
<p>
  There are three main classes of stripped-envelope supernovae, distinguished by how much hydrogen or helium they contain. Following Hachinger et al. (2012), we make the following distinction: 
</p>
<dl class="row" id='sn_types'>
  <dt class='col-2'>Type IIb</dt>
  <dd class='col-10'>Hydrogen-poor (> 0.03 M<sub>&#8857;</sub>), helium-rich</dd>
  <dt class='col-2'>Type Ib</dt>
  <dd class='col-10'>Hydrogen-free (<a href="#sn-types" title="But Dessart et al. (2012) found that this limit could be as low as 0.001 M<sub>&#8857;</sub>" data-toggle='tooltip' data-html='true' data-placement='top'>< 0.02 M<sub>&#8857;</sub></a>), helium-rich (> 0.14 M<sub>&#8857;</sub>)</dd>
  <dt class='col-2'>Type Ic</dt>
  <dd class='col-10'>Hydrogen-free (< 0.02 M<sub>&#8857;</sub>), helium-free (< 0.06 M<sub>&#8857;</sub>)</dd>
</dl>

<p>
  As this list shows, the amount of leftover hydrogen at explosion is an important determinant for the supernova type. In this lab, we will explore how much hydrogen is left on the surface of stripped stars and what its effect is, not the least for what supernova the star produces. 
</p>

<h4 id='part2c' class='mt-4'>Supernova Progenitors</h4>
<p>
  The detection of only one intermediate mass stripped star has been published. It is called a "quasi Wolf Rayet star" and is part of the binary system HD 45166 (e.g., <a href="https://ui.adsabs.harvard.edu/abs/2008A%26A...485..245G/abstract" target=_blank>Groh et al., 2008</a>). Even though stripped stars themselves appear rare or are rather difficult to locate, many supernovae thought to result from the collapse of stripped stars have been identified. These stripped-envelope supernovae are, unsurprisingly, hydrogen-poor and constitute about a third of all core-collapse supernovae (<a href="https://ui.adsabs.harvard.edu/abs/2011MNRAS.412.1522S/abstract" target=_blank>Smith et al., 2011</a>, <a href="https://ui.adsabs.harvard.edu/abs/2017ApJ...837..120G/abstract" target=_blank>Graur et al., 2017a</a>, <a href="https://ui.adsabs.harvard.edu/abs/2017ApJ...837..121G/abstract" target=_blank>Graur et al., 2017b</a>). 
</p>

<h4 id='part2d' class='mt-4'>High-mass X-ray Binaries</h4>
<p>
  We are forgetting that the accretor is a black hole! Black holes cannot accrete at infinite rates, but their mass accretion rates are thought to be limited by the so-called Eddington accretion rate. When the accretion rate reaches the Eddington accretion rate, the radiation pressure produced by the accretion is so strong that it can prevent accretion. 
</p>

<p>
  If mass accretion is not fully conservative, some material will be lost from the system, and it leaves with some angular momentum, which can affect the binary orbit. If the material is thought to be flung out after spending some time with the accreting star, it is thought to leave with the specific angular momentum equal to that of the accreting star - a process called isotropic re-emission. 
</p>

<p class='lead'>
  <span class='font-weight-bold text-primary'>Task 1: Limiting Retention</span> Search <code>$MESA_DIR/binary/defaults/binary_controls.defaults</code> for an inlist option that will limit the mass accretion rate onto the black hole by the eddington accretion rate. Activate that control and re-run the model. Use the results to answer the following questions:
</p>
<ul class='lead'>
  <li>Is the accretion efficient? That is, is 100% of the mass lost by the donor accreted by the black hole? If not, estimate the quantity <var>β</var> = <var>M&#775;</var><sub>acc</sub>/<var>M&#775;</var><sub>trans</sub>.</li>
  <li>What was the final orbital period after mass transfer? Compare to this orbital period to what we found before. Does this result make sense?</li>
</ul>

<div class="card border-primary mb-3">
  <div class="card-header bg-primary text-white">
    <button class="btn btn-link text-reset" type="button" data-toggle="collapse" data-target="#hint1_4a" aria-expanded="true" aria-controls="hint1_4a">
      Show Hint: The Inlist Control
    </button>
  </div>
  <div class="card-body collapse" id="hint1_4a">
    <p class="card-text">
      The name of the control is <code>limit_retention_by_mdot_edd</code>. From <code>$MESA_DIR/binary/defaults/binary_controls.defaults</code>:
    </p>
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="c1">! limit_retention_by_mdot_edd</span><span class="w">
</span><span class="c1">! ~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span class="w">

</span><span class="c1">! Limit accretion using ``mdot_edd``. The current implementation is intended for use with</span><span class="w">
</span><span class="c1">! black hole accretors, as in e.g. Podsiadlowski, Rappaport &amp; Han (2003), MNRAS, 341, 385.</span><span class="w">
</span><span class="c1">! For other accretors ``mdot_edd`` should be set with ``use_this_for_mdot_edd``, the hook</span><span class="w">
</span><span class="c1">! ``use_other_mdot_edd``, or by appropriately setting ``use_this_for_mdot_edd_eta``.</span><span class="w">
</span><span class="c1">! Note: MESA versions equal or lower than 8118 used eta=1 and did not correct</span><span class="w">
</span><span class="c1">! the accreted mass for the energy lost by radiation.</span><span class="w">

</span><span class="c1">! If accreted material radiates an amount of energy equal to ``L=eta*mtransfer_rate*clight**2``,</span><span class="w">
</span><span class="c1">! then accretion is assumed to be limited to the Eddington luminosity,</span><span class="w">

</span><span class="c1">! ::</span><span class="w">

</span><span class="c1">!     Ledd = 4*pi*cgrav*Mbh*clight/kappa</span><span class="w">

</span><span class="c1">! which results in the Eddington mass-accretion rate</span><span class="w">

</span><span class="c1">! ::</span><span class="w">

</span><span class="c1">!     mdot_edd = 4*pi*cgrav*Mbh/(kappa*clight*eta)</span><span class="w">

</span><span class="c1">! the efficiency eta is determined by the properties of the last stable circular orbit,</span><span class="w">
</span><span class="c1">! and for a BH with no initial spin it can be expressed in terms of the initial BH mass Mbh0</span><span class="w">
</span><span class="c1">! and the current BH mass,</span><span class="w">

</span><span class="c1">! ::</span><span class="w">

</span><span class="c1">!     eta = 1-sqrt(1-(Mbh/(3*Mbh0))**2)</span><span class="w">

</span><span class="c1">! for Mbh &lt; sqrt(6) Mbh0. For BHs with initial spins different from zero, an effective</span><span class="w">
</span><span class="c1">! Mbh0 can be computed, corresponding to the mass the black hole would have needed to</span><span class="w">
</span><span class="c1">! have with zero spin to reach the current mass and spin.</span><span class="w">

</span><span class="c1">! ::</span><span class="w">

    </span><span class="n">limit_retention_by_mdot_edd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">.false.</span></code></pre></figure>
    <p class='card-text'>
      But think carefully: in which namelist and inlist should this command go?
    </p>
  </div>
</div>

<div class="card border-success mb-3">
  <div class="card-header bg-success text-white make-clickable">
    <button class="btn btn-link text-reset stretched-link" type="button" data-toggle="collapse" data-target="#sol1_5" aria-expanded="true" aria-controls="sol1_5">
      Show Solution 1
    </button>
  </div>
  <div class="card-body collapse" id="sol1_5">
    <p class='card-text'>
      The following line should be added to the <code>&binary_controls</code> namelist in <code>inlist_project</code>:
<figure class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="w">   </span><span class="n">limit_retention_by_mdot_edd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">.false.</span></code></pre></figure>
    </p>
    <p class='card-text'>
      To determine if the mass transfer is efficient, we should look at the combined mass of the binary. If it is always 20 M<sub>&#8857;</sub> (since we started with a 12 M<sub>&#8857;</sub> star and an 8 M<sub>&#8857;</sub> black hole). Compare the top history panels from the pgstar dashboard before and after adding this control:
    </p>
    <h4>No Limits on Accretion</h4>
    <figure class='figure'>
      <img class='figure-img img-fluid rounded' src='images/mass_no_limit.png' alt='graphs showing mass of star decreasing and mass of black hole increasing with time'>
      <figcaption class="figure-caption text-left">
        Mass histories for stellar model (star 1) and black hole (star 2) when <em>not</em> limiting retention by the Eddington rate. This mass transfer is <strong>conservative</strong> because we specifically disallowed any losses in <code>inlist_project</code> (though wind mass loss from star 1 is actually lost from the system, so the total mass at the end of the evolution is less than the original 20 M<sub>&#8857;</sub>.
      </figcaption>
    </figure>

    <h4>Eddington-limited Accretion</h4>
    <figure class='figure'>
      <img class='figure-img img-fluid img-rounded' src='images/mass_limited.png' alt='graphs showing mass of star decreasing while mass of black hole remains constant'>
      <figcaption class="figure-caption text-left">
        Mass histories for stellar model (star 1) and black hole (star 2) when accretion retention <em>is limited</em> by the Eddington rate.
      </figcaption>
    </figure>
    <p class='card-text'>
      As we can see, applying the eddington limit scheme results in <strong>nonconservative mass transfer</strong>, as evidenced by apparently constant black hole mass while the donor loses mass. 
    </p>

    <p class='card-text'>
      We can estimate <var>β</var> by computing the change in mass of the black hole and dividing it by the magnitude of the change in mass of the donor star. From the last lines of data in the terminal output, we can find the final value of <var>M</var><sub>1</sub> is 4.390338 M<sub>&#8857;</sub>, while the final mass of the black hole, <var>M</var><sub>2</sub>, is 8.007592 M\<sub>&#8857;</sub>. Their starting masses were 12 M<sub>&#8857;</sub> and 8 M<sub>&#8857;</sub>, respectively. Thus, the mass retention efficiency is
    </p>
    \[\beta = \frac{M_{2,f} - M_{2,i}}{\left\vert M_{1,f} - M_{1,i}\right\vert} = \frac{8.007592\,M_\odot - 8.000000\,M_\odot}{\left\vert 4.390338\,M_\odot - 12.000000\,M_\odot\right\vert} = 0.000998 \approx 0.1\%\]
    <p class='card-text'>
      The final orbital period is approximately 57.8 days, which is larger than what we found when we didn't limit the accretion rate. This might be surprising since this simulation lost more angular momentum due to nonconservative mass transfer, but remember that the decreased mass of the system itself means a decreased angular momentum even if the period may have increased somewhat.
    </p>
  </div>
</div>

<h2 id="part3" class='mt-5'> Maxilab: Massive Binary Mergers</h2>

      </div>
    </div>      
  </div>
</body>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://code.jquery.com/jquery.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/application.js"></script>
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
<script type="text/javascript" async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML'></script>

<script src="/js/binaries.js"></script>

</html>
